@{
    ViewData["Title"] = "Dashboard - Sistema de Votação";
    var userRole = Context.Session.GetString("UserRole");
    var userName = Context.Session.GetString("UserName");
    var canManageUsers = userRole == "Adm";
    var canManageEntities = userRole == "Adm" || userRole == "Gerente";
}

<div class="container-fluid py-4">
    <!-- Cabeçalho -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="h2 mb-1"><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                            <p class="mb-0">Bem-vindo, <strong>@userName</strong>! Seu perfil: <span class="badge bg-light text-dark">@userRole</span></p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="h4 mb-0">
                                <i class="fas fa-calendar-day"></i> @DateTime.Now.ToString("dd/MM/yyyy")
                            </div>
                            <small>@DateTime.Now.ToString("HH:mm")</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cards de Estatísticas Rápidas -->
    <div class="row mb-4">
        <!-- Total de Eleitores -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total de Eleitores
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalEleitores">Carregando...</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total de Candidatos -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Total de Candidatos
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalCandidatos">Carregando...</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-tie fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total de Votos -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Votos Realizados
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalVotos">Carregando...</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-vote-yea fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status do Usuário -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Seu Status
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="statusVoto">Verificando...</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-check fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ações Rápidas Baseadas na Role -->
    <div class="row">
        <!-- Coluna para Admin -->
        @if (userRole == "Adm")
        {
            <div class="col-lg-4 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-crown"></i> Ações de Administrador</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="@Url.Action("Index", "Usuarios")" class="btn btn-danger btn-block mb-2">
                                <i class="fas fa-users-cog"></i> Gerenciar Usuários
                            </a>
                            <a href="@Url.Action("Index", "Eleitores")" class="btn btn-outline-danger btn-block mb-2">
                                <i class="fas fa-users"></i> Gerenciar Eleitores
                            </a>
                            <a href="@Url.Action("Index", "Candidatos")" class="btn btn-outline-danger btn-block mb-2">
                                <i class="fas fa-user-tie"></i> Gerenciar Candidatos
                            </a>
                            <a href="@Url.Action("Index", "Votos")" class="btn btn-outline-danger btn-block mb-2">
                                <i class="fas fa-poll"></i> Ver Todos os Votos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Coluna para Gerente -->
        @if (userRole == "Gerente" || userRole == "Adm")
        {
            <div class="col-lg-4 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-user-shield"></i> Ações de Gerente</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="@Url.Action("Index", "Eleitores")" class="btn btn-warning btn-block mb-2">
                                <i class="fas fa-users"></i> Gerenciar Eleitores
                            </a>
                            <a href="@Url.Action("Index", "Candidatos")" class="btn btn-outline-warning btn-block mb-2">
                                <i class="fas fa-user-tie"></i> Gerenciar Candidatos
                            </a>
                            <a href="@Url.Action("Index", "Votos")" class="btn btn-outline-warning btn-block mb-2">
                                <i class="fas fa-poll"></i> Ver Votos
                            </a>
                            <a href="@Url.Action("Resultado", "Public")" class="btn btn-outline-warning btn-block mb-2">
                                <i class="fas fa-chart-bar"></i> Resultados da Eleição
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Coluna para Todos os Usuários Logados -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-vote-yea"></i> Ações Gerais</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("Index", "Votos")" class="btn btn-success btn-block mb-2">
                            <i class="fas fa-vote-yea"></i> Realizar Voto
                        </a>
                        <a href="@Url.Action("Resultado", "Public")" class="btn btn-outline-success btn-block mb-2">
                            <i class="fas fa-chart-bar"></i> Ver Resultados
                        </a>
                        <a href="@Url.Action("Candidatos", "Public")" class="btn btn-outline-success btn-block mb-2">
                            <i class="fas fa-user-tie"></i> Ver Candidatos
                        </a>
                        <a href="@Url.Action("Eleitores", "Public")" class="btn btn-outline-success btn-block mb-2">
                            <i class="fas fa-users"></i> Ver Eleitores
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna de Informações do Sistema -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Informações do Sistema</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="fas fa-user"></i> Seus Dados:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Nome:</strong> @userName</li>
                            <li><strong>Perfil:</strong> <span class="badge bg-primary">@userRole</span></li>
                            <li><strong>Título Eleitoral:</strong> @Context.Session.GetString("TituloEleitoral")</li>
                        </ul>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <h6><i class="fas fa-shield-alt"></i> Permissões:</h6>
                        <small>
                            @switch (userRole)
                            {
                                case "Adm":
                                    <text>Você tem acesso completo a todas as funcionalidades do sistema.</text>
                                    break;
                                case "Gerente":
                                    <text>Você pode gerenciar eleitores, candidatos e visualizar votos.</text>
                                    break;
                                case "Comum":
                                    <text>Você pode votar e consultar informações públicas.</text>
                                    break;
                                default:
                                    <text>Permissões básicas de consulta.</text>
                                    break;
                            }
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seção de Avisos e Alertas -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-bell"></i> Avisos Importantes</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> <strong>Informação:</strong> O sistema está em pleno funcionamento.
                        Certifique-se de que seu voto foi registrado corretamente.
                    </div>

                    @if (userRole == "Comum")
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> <strong>Atenção:</strong>
                            Como usuário comum, você pode votar apenas uma vez. Verifique se já exerceu seu direito ao voto.
                        </div>
                    }

                    @if (userRole == "Adm" || userRole == "Gerente")
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> <strong>Privilégios:</strong>
                            Você tem permissões de gerenciamento no sistema. Use com responsabilidade.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simulação de carregamento de estatísticas
            // Em um sistema real, você faria requisições AJAX para obter os dados reais

            setTimeout(() => {
                document.getElementById('totalEleitores').textContent = '1.247';
                document.getElementById('totalCandidatos').textContent = '15';
                document.getElementById('totalVotos').textContent = '893';

                // Simular verificação de status de voto
                const userRole = '@userRole';
                if (userRole === 'Comum') {
                    document.getElementById('statusVoto').innerHTML = '<span class="text-warning">Não votou</span>';
                } else {
                    document.getElementById('statusVoto').innerHTML = '<span class="text-success">Ativo</span>';
                }
            }, 1000);

            // Atualizar horário em tempo real
            function updateTime() {
                const now = new Date();
                document.querySelector('.h4.mb-0').innerHTML = `<i class="fas fa-calendar-day"></i> ${now.toLocaleDateString('pt-BR')}`;
                document.querySelector('small').textContent = now.toLocaleTimeString('pt-BR');
            }

            setInterval(updateTime, 1000);
        });
    </script>

    <style>
        .border-left-primary {
            border-left: 4px solid #4e73df !important;
        }

        .border-left-success {
            border-left: 4px solid #1cc88a !important;
        }

        .border-left-info {
            border-left: 4px solid #36b9cc !important;
        }

        .border-left-warning {
            border-left: 4px solid #f6c23e !important;
        }

        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

            .card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
            }

        .btn-block {
            text-align: left;
            padding: 12px 20px;
        }

        .text-xs {
            font-size: 0.7rem;
        }

        .bg-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }
    </style>
}